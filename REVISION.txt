Revision history of openPOWERLINK Protocol Stack

Article no.:      SO-1083

Project start:    13.02.2006

Project manager:  R. Sieber (-rs)

Fellow worker:    Daniel Krüger (d.k.)
                  Michael Ulbricht (m.u.)

=============================================================================

07.11.2006 V1.0     First release, import into CVS
                    (d.k.)

18.01.2007 V1.1     MN support implemented
                    (d.k.)

04.02.2008 V1.1     Code cleanup based on PClint output
                    (d.k.)

14.04.2008 V1.1     - New driver and demo application for X86 with Realtek
                      RTL8139 network controller under Linux.
                    - several bug fixes in SDO module and NMT MN module.
                    (d.k., m.u.)

18.04.2008 V1.2     - new functions in EplApiLinuxUser interface
                    (m.u.)

17.06.2008 V1.2     - added support for RTL8139C, but refuse RTL8139C+
                    (d.k.)

14.07.2008 V1.2     - updates to EplApiLinux*.c for coming Qt demo
                    (d.k.)

23.06.2008 V1.2     - changed default node-ID to MN for RTL8139 MN demo application
                    - added SoA processing for ErrorHandler and PDO module on MN
                    - removed and fixed some TODOs and $$$
                    (d.k.)

19.08.2008 V1.2     - added Qt demo for X86 with RTL8139
                    - added handling of SDO errors on MN to demo projects.
                      These may occur if the CN drops and the SDO connection was not closed yet.
                    - added .cvsignore files to project directories
                    - added manufacturer specific EPL error codes (EPL_E_*) for
                      missing IdentResponse and StatusResponse
                    (d.k.)

25.08.2008 V1.2     - fixed bug in EplApiLinux*.c when EplApiShutdown() was called.
                      The process image thread still hung within Ioctl and therefore
                      the file release function was not called until SIGTERM.
                    (d.k.)

01.10.2008 V1.3     - SDO sequence layer: fixed error behaviour (reaction on retransmission request,
                      overrun of sequence number). tested against conformance test
                    - global.h: fixed 64-bit awarness of ARM GCC
                    (d.k.)

02.10.2008 V1.3     - updated XDD of Demo CN
                    - fixed size check when writing to OD (e.g. via SDO)
                    - made handling of some objects compliant to the spec (valid on reset, access rights)
                      (e.g. object 0x1006, 0x1F98/5)
                    (d.k.)

06.10.2008 V1.3     - added new module "PDO user part", which validates the PDO communication
                      and mapping parameters while changing them in the OD
                    - made object 0x1F8C NMT_CurrNmtState PDO-mappable (according to the spec)
                    - removed NMT MN state machine parts in Nmtu module, when MN is disabled
                    - disabled OBDu module in EplCfg.h of most projects, because EPL_OBD_USE_KERNEL
                      is used (by default in EplDef.h)
                    (d.k.)

16.10.2008 V1.3     - updated global.h with changes from CANopen
                    (d.k.)

17.10.2008 V1.3     - NMT MN module: delete timers while executing NMT reset communication
                    - DLL CN: ignore frame timeout of SoC in PreOp2, because otherwise we
                      would switch back and forth between PreOp2 and PreOp1
                    - ErrorHandlerk: added handling for LossOfPReq. Therefor object 0x1C0D was
                      added to objdict.h
                    - SDO communication layer: acknowledge NIL command on sequence layer
                    - adopt changes in objdict.h for XDD
                    - CN runs successfully through conformance test 0.9 on 2008/10/15
                    - added parentheses to all occurrences of EPL_MODULE_INTEGRATION,
                      hence using of EPL_MODULE_* defines to build it in EplCfg.h works.
                    (d.k.)

07.11.2008 V1.3     - added ARM support to global.h
                    - added Abstract Memory Interface for ARM processors (EplStack/amiarm.c)
                    (d.k.)

13.11.2008 V1.3     - fixed handling of NMT_MT6 (kEplNmtEventNmtCycleError) in NMT MN, NMTk and
                      DLLk module. The asynchronous queues are cleared now correctly, on change
                      from Op to PreOp1.
                    (d.k.)

14.11.2008 V1.3     - cf54drv for ECUcore-5484 now works on devboards with PCB 4158.4 and 4158.5
                    (d.k.)

17.11.2008 V1.3     - bug-fixes to demo-main.c of all targets:
                      * added prefix APP_ to local defines to avoid name collision with Linux for example
                      * added some objects to object dictionary for debugging purposes
                      * fixed speed selection (ignore upper bits now)
                      * global node-ID variable really reflects now the current node-ID
                      * added cyclelen parameter to kernel module
                    - added new Ethernet driver and demo project for Hilscher netX to special GPL-Addon
                    (d.k.)

21.11.2008 V1.3.1   - updated X86 Qt demo: it draws a rainbow now.
                    (d.k.)

24.11.2008 V1.3.1   - Edrv8139.c: workaround for bug in Linux kernel added (clearing driver structure
                      before calling pci_register_driver, because not all pointers inside the
                      structure are reset correctly, so some are freed twice which is very bad).
                    (d.k.)

05.12.2008 V1.3.1   - PDO module: ignore mapped object that does not exist.
                    (d.k.)

08.12.2008 V1.3.1   - EplApiLinuxKernel: using misc device instead of pure character device now,
                      because it automatically handles the sysfs entries
                    - added udev rule to X86 Qt demo
                    - updated demo_cn_kernel for ECUcore-5484 regarding the status and error LEDs
                    (d.k.)

03.02.2009 V1.3.1   - X86 Qt demo: added message box to show errors when initialization of the stack failed
                    - EplApiLinuxKernel.c: fixed hang in EplLinRelease(), when stack was not properly
                      initialized before (e.g. because of missing Ethernet controller)
                    (d.k.)

05.02.2009 V1.3.1   - added missing file EplLedu.c to public release
                    (d.k.)

18.02.2009 V1.3.1   - fixed bug in objdict.h: invalid declaration of MNCycTimeExceed cumulative
                      counter
                    - fixed project demo_cn_kernel for ECUcore-5484 + some clean-up
                    - clean-ups to project demo_mn_kernel for ECUcore-5484
                    (d.k.)

03.03.2009 V1.3.2   - ErrorHandlerk: increment cumulative counters even if threshold
                      counters are disabled
                    (d.k.)

18.03.2009 V1.3.2   - updated XDD to work with recent conformance test
                    (d.k.)

27.03.2009 V1.3.2   - EplSdoUdpu.c, ShbIpc-LinuxKernel.c: switch to kthread API, which works
                      in any 2.6 version of the Linux kernel.
                    - Edrv8139: added support for RTL8139C+ which is used in Qemu for example.
                      BTW, there is actually no difference in Tx buffer handling.
                    - added support for NMT requests (via object 0x1F9F and NMT
                      request frames)
                    - changed Makefile of MN demo for ECUcore-5484: removed dummy C files
                      that just contain includes of real C files. So this directory looks much cleaner.
                      Disadvantage: generated .o files are spawned over whole source tree.
                      There may be collisions with other projects working with the same files.
                    - changed Makefile of Qt demo project for X86: removed dummy C files that
                      just contain includes of real C files.
                    - Qt demo project for X86: added support for Basic Ethernet for state display.
                      Before this, it was handled as error state.
                    (d.k.)

30.03.2009 V1.3.2   - applied staging-epl-remove-compiler-warning-from-sharedbuff.c patch from Greg
                    - only include a file if it is needed
                    - applied staging-epl-fix-netdev-priv-b0rkage.patch from Greg:
                      netdev->priv is now gone, use netdev_priv() instead.
                    - applied staging-epl-fix-sparse-warning-in-proc_fs.c.patch from Greg:
                      proc_fs.c needs to include proc_fs.h
                    - applied staging-epl-fix-up-some-non-ansi-functions.patch from Greg:
                      () isn't valid, you need to put (void).
                    - EplApiGeneric: used wrong subindex for object 0x1F9F NMTRequest
                    (d.k.)

06.04.2009 V1.3.2   - Edrv8139: enabled promiscuous mode, so it is possible to brigde other
                      adapters like virtual machines on the epl network device
                    - SDO sequence layer: fixed reinit when connection is still alive (tested)
                    - SDO command layer: tried to fix abort handling on SDO server while segmented
                      transfer is active, but it seems not to work as expected
                    (d.k.)

06.04.2009 V1.4     - labeled V1.3.2 as V1.4
                    (d.k.)

12.05.2009 V1.5     - XDD: fixed wrong access types of some NumberOfEntries objects (should be const instead of ro);
                      changed name of object 0x1C14 to DLL_CNLossOfSocTolerance_U32;
                      fixed some default values (e.g. object 0x1f98/0x2, 0x1c0f/0x3, 0x1030/0x1)
                    - Api_CN objdict.h: changed default of object 0x1030/0x7 to 1.
                    - EplObd.c: changed EplObdGetDataSize internals to return string sizes without terminating null-character.
                      This fixes a bug in the SDO module which transmitted strings with terminating null-character.
                      But this is not allowed according to the spec.
                    (d.k.)

22.05.2009 V1.5     - made VirtualEthernetLinux.c compatible to Linux kernel V2.6.28 and higher
                      (new net_device_ops structure)
                    - synchronized global.h with the one from SYS TEC CANopen stack
                    - added some support for 64 bit processors
                    - added define for __func__ if it is missing (like MSVC)
                    (d.k.)

05.06.2009 V1.5     - added definition of hardware parameter structure for future
                      extension of init parameter structures
                    - Api_CN objdict.h: removed all #ifdef within parenthesis
                    (d.k.)

11.06.2009 V1.5     - added workaround for SdoBusy errors while configuring the cycle length
                      on the CN in X86 Qt demo
                    (d.k.)

12.06.2009 V1.5     - added tEplHwParam to init structures of API layer, DLLk and Edrv
                    (d.k.)

15.06.2009 V1.5     - fixed bug 2392067: kEplDllAsyncTxBufferFull leads to kEplShutdown in SDO ASnd layer
                    (d.k.)

22.06.2009 V1.5     - added support for object 0x1F9A NMT_HostName_VSTR in EPL API layer
                    - added object 0x1E40 NWL_IpAddrTable_0h_REC to objdict.h
                    - bug fix in XDD: same subindex was mentioned twice
                    - X86 Qt demo: added workaround for SdoBusy errors while configuring the cycle length
                    (d.k.)

24.06.2009 V1.5.1   - Highres timer on Linux: do not reject too smal time values, but increase them
                    - asynchronous send queues for StatusRequests and IdentRequests on MN:
                      made read and write index of queues volatile.
                    - DLLk module: moved timer creation to CbFrameTransmitted.
                      This prevents that the timeout elapses before the frame is actually transmitted
                      over the wire. This should solve the bug 2000711.
                    - fixed bug 2810782: prescaler of general purpose timer of
                      MCF548x was not properly calculated
                    - Windows port: It works now, except some bugs in EplTimeruWin32.c,
                      which lead to lost IdentReqs on MN.
                    (d.k.)

25.06.2009 V1.5.1   - included WinPcap 4.0.2 Developer's Pack in CVS (except docs
                      and examples)
                    - DLL: added critical section for callback functions from Edrv and highres
                      timer module. This is only necessary for platforms where Edrv and the
                      highres timer module are not able to ensure that the callback functions
                      are called mutual exclusive, e.g. Linux kernel except the Coldfire.
                    - X86 Qt demo: cleaned up the console output (e.g. NMT states),
                      removed some warnings.
                    (d.k.)

26.06.2009 V1.5.1   - OBD: renamed first part of OBD to GenericPart like in CANopen.
                    - EplObd.h: some clean-up
                    - API layer: added ObdInitRam function pointer to init parameters.
                      Now, the application with the OBD (objdict.*) can be easily separated
                      from the stack, i.e. the stack can be moved into a library.
                    - API wrapper for Linux kernel-user: added new function EplApiPostUserEvent()
                    (d.k.)

06.07.2009 V1.5.2   - removed some inexistent or unnecessary header files in Windows
                      project demo_pcap
                    (d.k.)

09.07.2009 V1.5.2   - EplDllkTgt.h: includes now linux/spinlock.h instead of asm/spinlock.h,
                      because this is the right way to do it
                    (d.k.)

20.07.2009 V1.5.2   - EplSdoUdpu.c: flush signals when receive thread finishes.
                    (d.k.)

28.07.2009 V1.5.2   - added support for Davicom DM9003 Ethernet controller connected to Atmel AT91RM9200
                      under Linux 2.6.22.
                    (d.k.)

03.08.2009 V1.6     - EplDllk.c: only accept LossOfFrameTolerance (object 0x1C14) in non NMT reset states,
                      because all other values are only valid on reset
                    (d.k.)

04.08.2009 V1.6     - changed semantic of EplDlluCalAsyncSend(): size includes Ethernet header now.
                      The function is now compatible to EplDllkCalAsyncSend().
                      This fixes wrong size of NMT commands and requests (were 14 bytes too large).
                    (d.k.)

05.08.2009 V1.6     - moved Virtual Ethernet driver from kernel part to user part:
                      * moved initialization from DLLk module to EPL API layer
                      * implemented setting of IP address and default gateway for virtual
                        Ethernet interface.
                    - Api_CN/objdict.h: made object 0x1F8F NMT_MNNodeExpState_AU8
                      read-only according to spec
                    (d.k.)

07.08.2009 V1.6     - event queues: added error event post if sink does not exist
                    - event processing: return error if event not handled
                    - small corrections to NMT state machine to comply to spec
                    - separated sync callback function into process and SoC,
            		  this implies the updates of all demo projects
            		  (i.e. use new CbSyncProcess for former CbSync)
                    (d.k.)

11.08.2009 V1.6     - changed the DLL module for the up-coming support of Ethernet controllers with auto-response feature,
                      i.e. switched to event triggered update of IdentRes, StatusRes and PRes
                      (they are not updated right before transmission anymore, but updated
                      when their content has changed)
                      and separated configuration of PReq/PRes payload limits and timeout from
                      EplDllkAddNode().
                    (d.k.)

12.08.2009 V1.6     - timer modules: fixed pointer to unsigned long conversion and vice versa of user-specific timer argument.
                      This will be bad on 64-bit CPUs where unsigned long has only 32 bit.
                      Now it is a union.
                    - improved debug messages in demo project for EdrvPcap under Windows.
                    - switched definition of PRINTF under Windows from trace (debug output window)
                      to standard printf, if _CONSOLE is defined (i.e. console project with main function
                      instead of WinMain).
                    (d.k.)

14.08.2009 V1.6     - added Ethernet driver and demo project for openMAC with Altera Nios2 CPU as CN
                      (including the Quartus II project for the EBV DBC3C40 board).
                      The openMAC is an Ethernet controller written in VHDL with auto-response feature
                    (d.k.)

21.08.2009 V1.6     - export functions of EPL API Layer if compiled as Windows DLL (bug 2841082)
                    - define the DLL export modifier if the project is compiled as DLL in
                      Visual Studio (bug 2841086)
                    (d.k.)

01.09.2009 V1.6     - add "Ms" to Timeout variables in SharedBuffer and ShbIpc* implementation to
                      clearly state the unit.
                    - fixed ShbIpc-LinuxKernel implementation: job-ready timeout is now treated in unit of 1 ms.
                    (d.k.)

02.09.2009 V1.6     - Eventk.c and SharedBuff implementation: fixed case of enum constant kShbPriorityHigh
                    - Added new ShbIpc implementation for use without any operating system (ShbIpc-NoOS.c)
                    - Added target specific functions for ShbIpc-NoOS.c for the Altera Nios2 CPU
                    (m.u.)

02.09.2009 V1.6     - New feature: implemented support in DLL for Ethernet drivers/controllers with auto-response
                      feature. There is a new function EdrvChangeFilter, which must be implemented by each Ethernet driver.
                    - memory leak fixed in Ethernet drivers for Pcap and RTL8139 chip, when releasing TxBuffers.
                      The real cause of this memory leak was in DLL module because it NULLified the m_pbBuffer pointer
                      in the TxBuffer structure before calling EdrvReleaseTxBuffer.
                    (d.k.)

04.09.2009 V1.6     - Added EplTimeru implementation for use without any operating system and with Windows (EplTimeruGeneric.c).
                      Now we have a proper functioning implementation of the low-res timers for Windows with PCap driver.
                    (m.u.)

08.09.2009 V1.6     - optimized PDO processing. It is several times faster that the old version.
                      All projects need the new module EplPdouCal.c and the module EplPdou.c now.
                      This implies adding EPL_MODULE_PDOU to the definition of EPL_MODULE_INTEGRATION in EplCfg.h.
                    (d.k.)

14.09.2009 V1.6     - fixed bug in boot step 1 of MN, where IdentRequest was issued twice (once by NMT Reset Node Sent event
                      and once by EplNmtMnuStartBootStep1)
                    (d.k.)

15.09.2009 V1.6     - implemented PRes filtering in DLL and PDOk module.
                    (d.k.)

16.09.2009 V1.6     - renamed EPL_NO_FIFO to EPL_USE_SHAREDBUFF
                    - LED module: inserted init state for status LED to force the status LED to off on NMT state initialization
                    - implemented new macro EPL_EVENT_USE_KERNEL_QUEUE for disabling
                      the kernel part event queue and directly processing kernel part events within interrupt lock
                    - cleaned-up default object dictionary: replaced magic constants
                      of object type and access rights with corresponding enum constants
                    (d.k.)

16.09.2009 V1.6     - implemented TimerHighResk for openMAC (compare unit)
                    (m.u.)

17.09.2009 V1.6     - code clean-up: removed unnecessary code and comments, restructured some functions
                    (d.k.)

